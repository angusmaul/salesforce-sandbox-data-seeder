---
name: Enhanced Schema Discovery with Validation Rules
status: completed
created: 2025-08-22T04:27:08Z
updated: 2025-08-22T05:24:33Z
last_sync: 2025-08-22T05:24:33Z
github: https://github.com/angusmaul/salesforce-sandbox-data-seeder/issues/5
depends_on: []
parallel: true
conflicts_with: [003]
---

# Task: Enhanced Schema Discovery with Validation Rules

## Description
Extend the existing Salesforce schema discovery service to extract and parse validation rules, field dependencies, and constraint patterns. This enhanced metadata will enable AI analysis of business logic and validation requirements. Implement anonymization layer to protect sensitive org data when sending schema summaries to Claude API.

## Acceptance Criteria
- [ ] Validation rule extraction from Salesforce Metadata API integrated into discovery process
- [ ] Parse validation rule formulas and extract field dependencies
- [ ] Identify required field patterns and constraint relationships
- [ ] Create schema anonymization layer that preserves structure while protecting sensitive data
- [ ] Generate structured schema summaries suitable for AI analysis
- [ ] Extend existing discovery results with validation metadata
- [ ] Cache validation rule analysis to improve performance

## Technical Details

### Implementation Approach
- Extend existing `web/server/services/enhanced-discovery.ts` 
- Use JSForce Metadata API to fetch validation rules for discovered objects
- Parse validation rule formulas to extract field relationships and constraints
- Create anonymization functions that replace sensitive field names with generic identifiers

### Key Considerations
- **Privacy**: Anonymize all org-specific field names and values before AI processing
- **Performance**: Cache validation rule parsing results per org
- **Complexity**: Some validation rules may be too complex for initial parsing
- **Integration**: Build on existing discovery infrastructure without disrupting current flow

### Code Locations/Files Affected
- `web/server/services/enhanced-discovery.ts` (extend existing)
- `web/server/lib/validation-rule-parser.js` (new)
- `web/server/lib/schema-anonymizer.js` (new)
- `web/server/demo-server.js` (update discovery endpoints)

## Dependencies
- [ ] Study existing discovery service architecture and data structures
- [ ] Research Salesforce Metadata API validation rule access patterns
- [ ] Understand current caching mechanisms for schema data

## Effort Estimate
- Size: L
- Hours: 24-28 hours
- Parallel: true (can develop alongside Claude API integration)

## Definition of Done
- [ ] Code implemented extending current discovery with validation rule parsing
- [ ] Anonymization layer tested to ensure no sensitive data exposure
- [ ] Integration tests written for validation rule extraction
- [ ] Performance testing with large orgs (500+ objects, 1000+ validation rules)
- [ ] Documentation updated for new discovery capabilities
- [ ] Backward compatibility maintained with existing discovery consumers